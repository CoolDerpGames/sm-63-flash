(()=>{"use strict";const e={ruffleEnable:!0,ignoreOptout:!1};let r,s,o,t,n;function a(e){return new Promise(((r,s)=>{e((e=>{const o=chrome.runtime.lastError;o?s(o):r(e)}))}))}if("undefined"!=typeof chrome)r={getMessage:e=>chrome.i18n.getMessage(e)},s={local:{get:e=>a((r=>chrome.storage.local.get(e,r))),remove:e=>a((r=>chrome.storage.local.remove(e,r))),set:e=>a((r=>chrome.storage.local.set(e,r)))},sync:{get:e=>a((r=>chrome.storage.sync.get(e,r))),remove:e=>a((r=>chrome.storage.sync.remove(e,r))),set:e=>a((r=>chrome.storage.sync.set(e,r)))},onChanged:{addListener:e=>chrome.storage.onChanged.addListener(e)}},o={reload:e=>a((r=>chrome.tabs.reload(e,void 0,r))),query:e=>a((r=>chrome.tabs.query(e,r))),sendMessage:(e,r,s)=>a((o=>chrome.tabs.sendMessage(e,r,s,o)))},t={onMessage:{addListener:e=>chrome.runtime.onMessage.addListener(e)},getURL:e=>chrome.runtime.getURL(e)},n=()=>a((e=>chrome.tabs.create({url:"/options.html"},e)));else{if("undefined"==typeof browser)throw new Error("Extension API not found.");r={getMessage:e=>browser.i18n.getMessage(e)},s={local:{get:e=>browser.storage.local.get(e),remove:e=>browser.storage.local.remove(e),set:e=>browser.storage.local.set(e)},sync:{get:e=>browser.storage.sync.get(e),remove:e=>browser.storage.sync.remove(e),set:e=>browser.storage.sync.set(e)},onChanged:{addListener:e=>browser.storage.onChanged.addListener(e)}},o={reload:e=>browser.tabs.reload(e),query:e=>browser.tabs.query(e),sendMessage:(e,r,s)=>browser.tabs.sendMessage(e,r,s)},t={onMessage:{addListener:e=>browser.runtime.onMessage.addListener(e)},getURL:e=>browser.runtime.getURL(e)},n=()=>browser.runtime.openOptionsPage()}function c(e){if(function(e){const r=e.responseHeaders.find((({name:e})=>"content-type"===e.toLowerCase()));if(!r)return!1;const s=r.value.toLowerCase().match(/^\s*(.*?)\s*(?:;.*)?$/)[1];if("application/octet-stream"===s){const r=new URL(e.url);return".swf"===r.pathname.substring(r.pathname.lastIndexOf(".")).toLowerCase()}return"application/x-shockwave-flash"===s}(e))return{redirectUrl:`${t.getURL("player.html")}?url=${e.url}`}}function g(){(chrome||browser).webRequest.onHeadersReceived.addListener(c,{urls:["<all_urls>"],types:["main_frame"]},["blocking","responseHeaders"])}(async()=>{const{ruffleEnable:r}=await async function(r){const o=await s.sync.get(["ruffleEnable"]);return Object.assign(Object.assign({},e),o)}();r&&g(),s.onChanged.addListener(((e,r)=>{"sync"===r&&"ruffleEnable"in e&&(e.ruffleEnable.newValue?g():(chrome||browser).webRequest.onHeadersReceived.removeListener(c))}))})()})();